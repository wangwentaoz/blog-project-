{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// import imgDefault from '../assets/logo.png'\n// import Cookie from 'js-cookie'\nexport default {\n  data: function data() {\n    return {\n      form: {\n        nickname: this.nickname\n      },\n      imageUrl: null // imgDefault: imgDefault\n\n    };\n  },\n  methods: {\n    save: function save() {\n      var _this = this;\n\n      this.$axios.post('/api/user/updateUser', {\n        nickname: this.form.nickname,\n        head_img: this.imageUrl\n      }).then(function (res) {\n        console.log(res);\n\n        if (res.data.code === 0) {\n          _this.$message({\n            message: '更新成功',\n            type: 'success'\n          });\n\n          setTimeout(function () {\n            location.reload();\n          }, 1500);\n        }\n      }).catch(function (e) {\n        console.log(e);\n      });\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res) {\n      this.imageUrl = res.data;\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === 'image/jpeg';\n      var isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG 格式!');\n      }\n\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n\n      return isJPG && isLt2M;\n    },\n    getUserInfo: function getUserInfo() {\n      var _this2 = this;\n\n      this.$axios.get('/api/user/info').then(function (res) {\n        var result = res.data;\n\n        if (result.code === 0) {\n          _this2.form.nickname = result.data.nickname;\n\n          if (result.data.head_img === '' || result.data.head_img === null) {\n            _this2.imageUrl = null;\n          } else {\n            _this2.imageUrl = result.data.head_img;\n          }\n        }\n      }).catch(function (e) {\n        console.log(e);\n      });\n    },\n    signOut: function signOut() {\n      // Cookie.remove('token')\n      this.$store.commit('setToken', '');\n      this.$store.commit('changIsSignIn', 0);\n      this.$router.push({\n        name: 'home'\n      });\n    }\n  },\n  created: function created() {\n    this.getUserInfo();\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;EACAA,IADA,kBACA;IACA;MACAC;QACAC;MADA,CADA;MAIAC,cAJA,CAKA;;IALA;EAOA,CATA;EAUAC;IACAC,IADA,kBACA;MAAA;;MACA,YACAC,IADA,CACA,sBADA,EACA;QACAJ,4BADA;QAEAK;MAFA,CADA,EAKAC,IALA,CAKA;QACAC;;QACA;UACA;YACAC,eADA;YAEAC;UAFA;;UAIAC;YACAC;UACA,CAFA,EAEA,IAFA;QAGA;MACA,CAhBA,EAiBAC,KAjBA,CAiBA;QACAL;MACA,CAnBA;IAoBA,CAtBA;IAuBAM,mBAvBA,+BAuBAC,GAvBA,EAuBA;MACA;IACA,CAzBA;IA0BAC,kBA1BA,8BA0BAC,IA1BA,EA0BA;MACA;MACA;;MAEA;QACA;MACA;;MACA;QACA;MACA;;MACA;IACA,CArCA;IAsCAC,WAtCA,yBAsCA;MAAA;;MACA,YACAC,GADA,CACA,gBADA,EAEAZ,IAFA,CAEA;QACA;;QACA;UACA;;UACA;YACA;UACA,CAFA,MAEA;YACA;UACA;QACA;MACA,CAZA,EAaAM,KAbA,CAaA;QACAL;MACA,CAfA;IAgBA,CAvDA;IAwDAY,OAxDA,qBAwDA;MACA;MACA;MACA;MACA;QAAAC;MAAA;IACA;EA7DA,CAVA;EAyEAC,OAzEA,qBAyEA;IACA;EACA;AA3EA","names":["data","form","nickname","imageUrl","methods","save","post","head_img","then","console","message","type","setTimeout","location","catch","handleAvatarSuccess","res","beforeAvatarUpload","file","getUserInfo","get","signOut","name","created"],"sourceRoot":"src/views","sources":["Personal.vue"],"sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <div class=\"content\">\n      <el-form :model=\"form\" ref=\"form\" label-width=\"80px\">\n        <el-form-item label=\"昵称\">\n          <el-input v-model=\"form.nickname\" class=\"nickname\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"头像\">\n          <el-upload\n            class=\"avatar-uploader\"\n            action=\"http://127.0.0.1:3000/api/user/upload\"\n            :show-file-list=\"false\"\n            :on-success=\"handleAvatarSuccess\"\n            :before-upload=\"beforeAvatarUpload\"\n            name=\"head_img\"\n          >\n            <!-- <img :src=\"imageUrl!=null?imageUrl:imgDefault\" class=\"avatar\">/ -->\n          </el-upload>\n          <p class=\"tips\">tips:请上传2M以内JPG/PNG格式的图片，比例最好1:1</p>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"save\">保存</el-button>\n          <el-button @click=\"signOut\">退出登录</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\n// import imgDefault from '../assets/logo.png'\n// import Cookie from 'js-cookie'\nexport default {\n  data() {\n    return {\n      form: {\n        nickname: this.nickname,\n      },\n      imageUrl: null,\n      // imgDefault: imgDefault\n    };\n  },\n  methods: {\n    save() {\n      this.$axios\n        .post('/api/user/updateUser', {\n          nickname: this.form.nickname,\n          head_img: this.imageUrl,\n        })\n        .then((res) => {\n          console.log(res);\n          if (res.data.code === 0) {\n            this.$message({\n              message: '更新成功',\n              type: 'success',\n            });\n            setTimeout(() => {\n              location.reload();\n            }, 1500);\n          }\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    },\n    handleAvatarSuccess(res) {\n      this.imageUrl = res.data;\n    },\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg';\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return isJPG && isLt2M;\n    },\n    getUserInfo() {\n      this.$axios\n        .get('/api/user/info')\n        .then((res) => {\n          let result = res.data;\n          if (result.code === 0) {\n            this.form.nickname = result.data.nickname;\n            if (result.data.head_img === '' || result.data.head_img === null) {\n              this.imageUrl = null;\n            } else {\n              this.imageUrl = result.data.head_img;\n            }\n          }\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    },\n    signOut() {\n      // Cookie.remove('token')\n      this.$store.commit('setToken', '');\n      this.$store.commit('changIsSignIn', 0);\n      this.$router.push({ name: 'home' });\n    },\n  },\n  created() {\n    this.getUserInfo();\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.wrapper {\n  min-height: calc(100vh - 262px);\n  .content {\n    width: 40%;\n    margin: 0 auto;\n    padding: 50px 0;\n  }\n}\n.nickname {\n  width: 70%;\n}\n.avatar-uploader {\n  .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n    &:hover {\n      border-color: #409eff;\n    }\n  }\n  .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 100px;\n    height: 100px;\n    line-height: 100px;\n    text-align: center;\n  }\n  .avatar {\n    width: 100px;\n    height: 100px;\n    display: block;\n  }\n}\n.tips {\n  font-size: 12px;\n  color: #999;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}